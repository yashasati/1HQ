"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[72],{1072:(K,h,s)=>{s.r(h),s.d(h,{NotificationsModule:()=>D});var g=s(4364),d=s(6798),v=s(6491),_=s(9170),F=s(1435),c=s(1707),t=s(2316),S=s(299);let b=(()=>{class i{constructor(n){this.http=n}getAll(n){return this.http.get(`notifications/${n}/subscriptions`)}updateUserSubscriptions(n,o){return this.http.put(`notifications/${n}/subscriptions`,{selections:o})}}return i.\u0275fac=function(n){return new(n||i)(t.LFG(S.r))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var P=s(4688),A=s(5718),C=s(6034),N=s(837),p=s(781),x=s(5515),Z=s(4058);function T(i,a){if(1&i){const n=t.EpF();t.TgZ(0,"div",12),t.TgZ(1,"div",13),t._uU(2),t.qZA(),t.TgZ(3,"mat-checkbox",14),t.NdJ("change",function(e){const l=t.CHM(n).$implicit,u=t.oxw(3);return e?u.toggleAllRowsFor(l):null}),t.qZA(),t.qZA()}if(2&i){const n=a.$implicit,o=t.oxw(3);t.xp6(2),t.Oqu(n),t.xp6(1),t.Q6J("checked",o.allRowsSelectedFor(n))("indeterminate",o.someRowsSelectedFor(n)&&!o.allRowsSelectedFor(n))("disabled","browser"===n&&!o.supportsBrowserNotifications)}}function w(i,a){if(1&i&&(t.ynx(0),t.YNc(1,T,4,4,"div",11),t.BQk()),2&i){const n=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",n.availableChannels)}}function M(i,a){if(1&i&&(t.TgZ(0,"div",12),t._UZ(1,"mat-checkbox",17),t.qZA()),2&i){const n=a.$implicit;t.xp6(1),t.Q6J("formControlName",n)}}function J(i,a){if(1&i&&(t.TgZ(0,"div",15),t.TgZ(1,"div",16),t._uU(2),t.qZA(),t.YNc(3,M,2,1,"div",11),t.qZA()),2&i){const n=a.$implicit,o=a.last,e=t.oxw(2);t.ekj("no-border",o),t.Q6J("formGroupName",n.notif_id),t.xp6(2),t.Oqu(n.name),t.xp6(1),t.Q6J("ngForOf",e.availableChannels)}}function k(i,a){if(1&i&&(t.TgZ(0,"div",5),t.TgZ(1,"div",6),t.TgZ(2,"div",7),t._uU(3),t.qZA(),t.YNc(4,w,2,1,"ng-container",8),t.qZA(),t.TgZ(5,"div",9),t.YNc(6,J,4,5,"div",10),t.qZA(),t.qZA()),2&i){const n=a.$implicit,o=a.first,e=t.oxw();t.xp6(3),t.Oqu(n.group_name),t.xp6(1),t.Q6J("ngIf",o),t.xp6(1),t.Q6J("formGroup",e.form),t.xp6(1),t.Q6J("ngForOf",n.subscriptions)}}let U=(()=>{class i{constructor(n,o,e,r,l,u){this.route=n,this.api=o,this.currentUser=e,this.toast=r,this.cd=l,this.settings=u,this.availableChannels=[],this.loading$=new v.X(!1),this.supportsBrowserNotifications="Notification"in window,this.form=new c.cw({})}ngOnInit(){this.route.data.subscribe(n=>{this.groupedNotifications=n.api.subscriptions,this.availableChannels=n.api.available_channels,this.initialUserSelections=n.api.user_selections,this.groupedNotifications.forEach(o=>{o.subscriptions.forEach(e=>this.addNotifFormField(e.notif_id))})})}addNotifFormField(n){const o=new c.cw({});this.availableChannels.forEach(e=>{var r;const l=null===(r=this.initialUserSelections.find(f=>f.notif_id===n))||void 0===r?void 0:r.channels[e],m=new c.NI({value:null!=l&&l,disabled:"browser"===e&&!this.supportsBrowserNotifications});"browser"===e&&"granted"!==Notification.permission&&m.valueChanges.pipe((0,_.h)(f=>f)).subscribe(f=>{"denied"===Notification.permission?(this.toast.open("Notifications blocked. Please enable them for this site from browser settings."),m.setValue(!1,{emitEvent:!1}),this.cd.markForCheck()):Notification.requestPermission().then(q=>{"granted"!==q&&(m.setValue(!1,{emitEvent:!1}),this.cd.markForCheck())})}),o.addControl(e,m)}),this.form.addControl(n,o)}toggleAllRowsFor(n){const o=!this.allRowsSelectedFor(n);Object.values(this.form.controls).forEach(e=>{e.controls[n].setValue(o),e.controls[n].markAsDirty()})}allRowsSelectedFor(n){return Object.values(this.form.controls).every(o=>!0===o.controls[n].value)}someRowsSelectedFor(n){return Object.values(this.form.controls).some(o=>!0===o.controls[n].value)}saveSettings(){this.loading$.next(!0);const n=this.getPayload();this.api.updateUserSubscriptions(this.currentUser.get("id"),n).pipe((0,F.x)(()=>this.loading$.next(!1))).subscribe(()=>{this.form.markAsPristine(),this.toast.open("Notification settings updated.")})}getPayload(){return Object.entries(this.form.controls).filter(([n,o])=>o.dirty).map(([n,o])=>({notif_id:n,channels:o.value}))}}return i.\u0275fac=function(n){return new(n||i)(t.Y36(d.gz),t.Y36(b),t.Y36(P.I),t.Y36(A.F),t.Y36(t.sBO),t.Y36(C.Z))},i.\u0275cmp=t.Xpm({type:i,selectors:[["notification-subscriptions"]],decls:7,vars:5,consts:[[1,"box-shadow",3,"menuPosition"],[1,"be-container"],[1,"table","material-panel",3,"ngSubmit"],["class","setting-group",4,"ngFor","ngForOf"],["mat-raised-button","","color","accent","trans","",1,"submit-button",3,"disabled"],[1,"setting-group"],[1,"row"],["trans","",1,"name-column","strong"],[4,"ngIf"],[3,"formGroup"],["class","row indent",3,"no-border","formGroupName",4,"ngFor","ngForOf"],["class","channel-column",4,"ngFor","ngForOf"],[1,"channel-column"],["trans","",1,"channel-name"],[3,"checked","indeterminate","disabled","change"],[1,"row","indent",3,"formGroupName"],["trans","",1,"name-column"],[3,"formControlName"]],template:function(n,o){1&n&&(t._UZ(0,"material-navbar",0),t.TgZ(1,"div",1),t.TgZ(2,"form",2),t.NdJ("ngSubmit",function(){return o.saveSettings()}),t.YNc(3,k,7,4,"div",3),t.TgZ(4,"button",4),t.ALo(5,"async"),t._uU(6," Save Settings "),t.qZA(),t.qZA(),t.qZA()),2&n&&(t.Q6J("menuPosition",o.settings.get("vebto.navbar.defaultPosition")),t.xp6(3),t.Q6J("ngForOf",o.groupedNotifications),t.xp6(1),t.Q6J("disabled",t.lcZ(5,3,o.loading$)))},directives:[N.e,c._Y,c.JL,c.F,g.sg,p.lW,x.P,g.O5,c.sg,Z.oG,c.x0,c.JJ,c.u],pipes:[g.Ov],styles:["[_nghost-%COMP%]{display:block;background-color:var(--be-background-alternative);min-height:100vh}.be-container[_ngcontent-%COMP%]{padding-top:35px;padding-bottom:35px}.table[_ngcontent-%COMP%]{border-radius:4px}.setting-group[_ngcontent-%COMP%]{margin-bottom:10px}.row[_ngcontent-%COMP%]{display:flex;align-items:center;border-bottom:1px solid var(--be-divider-default);padding:10px}.row.no-border[_ngcontent-%COMP%]{border-bottom:none}.row.indent[_ngcontent-%COMP%]{padding-left:20px}.name-column[_ngcontent-%COMP%]{flex:1 1 auto}.strong[_ngcontent-%COMP%]{font-weight:500;font-size:1.5rem;align-self:flex-end}.channel-name[_ngcontent-%COMP%]{margin-bottom:10px}.channel-column[_ngcontent-%COMP%]{width:75px;text-align:center;text-transform:capitalize}.submit-button[_ngcontent-%COMP%]{margin-top:15px}"],changeDetection:0}),i})();var Y=s(8293),$=s(5816),O=s(8117),Q=s(1134);let R=(()=>{class i{constructor(n,o,e){this.router=n,this.subscriptions=o,this.currentUser=e}resolve(n,o){return this.subscriptions.getAll(+this.currentUser.get("id")).pipe((0,Y.K)(()=>(this.router.navigate(["/account/settings"]),O.E)),(0,$.zg)(e=>e?(0,Q.of)(e):(this.router.navigate(["/account/settings"]),O.E)))}}return i.\u0275fac=function(n){return new(n||i)(t.LFG(d.F0),t.LFG(b),t.LFG(P.I))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var W=s(9665),B=s(6605),j=s(1682);function z(i,a){if(1&i){const n=t.EpF();t.TgZ(0,"li"),t.TgZ(1,"button",4),t.NdJ("click",function(){const r=t.CHM(n).$implicit;return t.oxw().selectPage(r)}),t._uU(2),t.qZA(),t.qZA()}if(2&i){const n=a.$implicit,o=t.oxw();t.xp6(1),t.ekj("active",o.currentPage===n),t.Q6J("disabled",o.disabled),t.xp6(1),t.Oqu(n)}}let E=(()=>{class i{constructor(n){this.router=n,this.pageChanged=new t.vpe,this.disabled=!0}get shouldHide(){return this.numberOfPages<2}set pagination(n){n&&(this.numberOfPages=n.last_page>10?10:n.last_page,this.numberOfPages>1&&(this.iterator=Array.from(Array(this.numberOfPages).keys()).map(o=>o+1),this.currentPage=n.current_page))}selectPage(n){this.currentPage!==n&&(this.currentPage=n,this.pageChanged.next(n),this.router.navigate([],{queryParams:{page:n},replaceUrl:!0}))}nextPage(){const n=this.currentPage+1;this.selectPage(n<=this.numberOfPages?n:this.currentPage)}prevPage(){const n=this.currentPage-1;this.selectPage(n>=1?n:this.currentPage)}}return i.\u0275fac=function(n){return new(n||i)(t.Y36(d.F0))},i.\u0275cmp=t.Xpm({type:i,selectors:[["pagination-widget"]],hostVars:2,hostBindings:function(n,o){2&n&&t.ekj("hidden",o.shouldHide)},inputs:{disabled:"disabled",pagination:"pagination"},outputs:{pageChanged:"pageChanged"},decls:8,vars:3,consts:[[1,"page-numbers","unstyled-list"],["type","button","mat-button","","trans","",1,"prev",3,"disabled","click"],[4,"ngFor","ngForOf"],["type","button","mat-button","","trans","",1,"next",3,"disabled","click"],["type","button","mat-flat-button","","color","gray",1,"page-number-button",3,"disabled","click"]],template:function(n,o){1&n&&(t.TgZ(0,"ul",0),t.TgZ(1,"li"),t.TgZ(2,"button",1),t.NdJ("click",function(){return o.prevPage()}),t._uU(3,"Previous"),t.qZA(),t.qZA(),t.YNc(4,z,3,4,"li",2),t.TgZ(5,"li"),t.TgZ(6,"button",3),t.NdJ("click",function(){return o.nextPage()}),t._uU(7,"Next"),t.qZA(),t.qZA(),t.qZA()),2&n&&(t.xp6(2),t.Q6J("disabled",o.disabled),t.xp6(2),t.Q6J("ngForOf",o.iterator),t.xp6(2),t.Q6J("disabled",o.disabled))},directives:[p.lW,x.P,g.sg],styles:["[_nghost-%COMP%]{display:block}ul[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;flex-wrap:wrap;width:100%}li[_ngcontent-%COMP%]{margin:0 3px 6px}.page-number-button[_ngcontent-%COMP%]{width:40px;height:40px;min-width:40px;line-height:40px;padding:0}.active[_ngcontent-%COMP%]{background-color:var(--be-accent-default);color:var(--be-accent-contrast)}.next[_ngcontent-%COMP%], .prev[_ngcontent-%COMP%]{color:var(--be-accent-default)}"],changeDetection:0}),i})();const G=[{path:"",component:(()=>{class i{constructor(n,o,e,r){this.settings=n,this.notifications=o,this.breakpoints=e,this.route=r,this.pagination$=new v.X(null)}ngOnInit(){this.loadPage(this.route.snapshot.queryParams.page||1)}loadPage(n){this.notifications.load({page:n,perPage:25}).subscribe(o=>{this.pagination$.next(o.pagination)})}markAsRead(n){this.pagination$.value.data.find(e=>e.id===n.id).read_at=n.read_at}}return i.\u0275fac=function(n){return new(n||i)(t.Y36(C.Z),t.Y36(W.g),t.Y36(B.S),t.Y36(d.gz))},i.\u0275cmp=t.Xpm({type:i,selectors:[["notification-page"]],decls:8,vars:13,consts:[[3,"menuPosition"],[1,"be-container"],[3,"notifications","compact","markedAsRead"],[3,"pagination","disabled","pageChanged"]],template:function(n,o){if(1&n&&(t._UZ(0,"material-navbar",0),t.TgZ(1,"div",1),t.TgZ(2,"notification-list",2),t.NdJ("markedAsRead",function(r){return o.markAsRead(r)}),t.ALo(3,"async"),t.ALo(4,"async"),t.qZA(),t.TgZ(5,"pagination-widget",3),t.NdJ("pageChanged",function(r){return o.loadPage(r)}),t.ALo(6,"async"),t.ALo(7,"async"),t.qZA(),t.qZA()),2&n){let e;t.Q6J("menuPosition",o.settings.get("vebto.navbar.defaultPosition")),t.xp6(2),t.Q6J("notifications",null==(e=t.lcZ(3,5,o.pagination$))?null:e.data)("compact",t.lcZ(4,7,o.breakpoints.isMobile$)),t.xp6(3),t.Q6J("pagination",t.lcZ(6,9,o.pagination$))("disabled",t.lcZ(7,11,o.notifications.loading$))}},directives:[N.e,j.Z,E],pipes:[g.Ov],styles:["[_nghost-%COMP%]{display:block;min-height:100vh;background-color:var(--be-background-alternative)}.be-container[_ngcontent-%COMP%]{padding-top:25px;padding-bottom:25px}pagination-widget[_ngcontent-%COMP%]{margin-top:35px}"],changeDetection:0}),i})()},{path:"settings",component:U,resolve:{api:R},data:{permissions:["notification.subscribe"]}}];let L=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[d.Bz.forChild(G)],d.Bz]}),i})();var I=s(8285),X=s(744),H=s(8295),y=s(9866);let V=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[g.ez,p.ot,y.N]]}),i})(),D=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[g.ez,c.u5,c.UX,L,H.l,I.T,X.m,V,y.N,Z.p9,p.ot]]}),i})()}}]);
//# sourceMappingURL=72.5d651031f136edc9d107.js.map