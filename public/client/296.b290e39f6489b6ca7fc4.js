"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[296],{6665:(nt,v,o)=>{o.r(v),o.d(v,{CrupdatePersonModule:()=>et});var u=o(4364),c=o(6798),p=o(3786),l=o(847);let P=(()=>{class n{constructor(a){this.id=a}}return n.type="[CrupdatePerson] Load Person",n})(),b=(()=>{class n{constructor(a){this.id=a}}return n.type="[CrupdatePerson] Detach Credit",n})(),A=(()=>{class n{constructor(a){this.payload=a}}return n.type="[CrupdatePerson] Create Person",n})(),y=(()=>{class n{constructor(a){this.payload=a}}return n.type="[CrupdatePerson] Update Person",n})(),T=(()=>{class n{}return n.type="[CrupdatePerson] Reset State",n})();class U{constructor(e={}){for(const a in e)this[a]=e[a]}}var g=o(8636),h=o(1435),t=o(2316),J=o(5810),Q=o(3340);let r=class{constructor(e,a){this.people=e,this.titles=a}static person(e){return e.person}static loading(e){return e.loading}static credits(e){return e.credits}loadPerson(e,a){return e.patchState({loading:!0}),this.people.get(a.id).pipe((0,g.b)(i=>{e.patchState({person:i.person,credits:this.flattenCredits(i.credits),loading:!1})}))}createPerson(e,a){return e.patchState({loading:!0}),this.people.create(a.payload).pipe((0,h.x)(()=>e.patchState({loading:!1})),(0,g.b)(i=>e.patchState({person:i.person})))}updatePerson(e,a){return e.patchState({loading:!0}),this.people.update(e.getState().person.id,a.payload).pipe((0,h.x)(()=>e.patchState({loading:!1})),(0,g.b)(i=>e.patchState({person:i.person})))}removeCredit(e,a){return e.patchState({loading:!0}),this.titles.removeCredit(a.id).pipe((0,g.b)(()=>{const i=e.getState().credits.filter(m=>m.pivot.id!==a.id);e.patchState({credits:i})}),(0,h.x)(()=>e.patchState({loading:!1})))}resetState(e){e.patchState({person:new U,credits:[],loading:!1})}flattenCredits(e){const a=[];return Object.keys(e).forEach(i=>{a.push(...e[i])}),a}};r.\u0275fac=function(e){return new(e||r)(t.LFG(J.g),t.LFG(Q.d))},r.\u0275prov=t.Yz7({token:r,factory:r.\u0275fac}),(0,p.gn)([(0,l.aU)(P)],r.prototype,"loadPerson",null),(0,p.gn)([(0,l.aU)(A)],r.prototype,"createPerson",null),(0,p.gn)([(0,l.aU)(y)],r.prototype,"updatePerson",null),(0,p.gn)([(0,l.aU)(b)],r.prototype,"removeCredit",null),(0,p.gn)([(0,l.aU)(T)],r.prototype,"resetState",null),(0,p.gn)([(0,l.Qf)()],r,"person",null),(0,p.gn)([(0,l.Qf)()],r,"loading",null),(0,p.gn)([(0,l.Qf)()],r,"credits",null),r=(0,p.gn)([(0,l.ZM)({name:"crupdatePerson",defaults:{person:new U,credits:[],loading:!1}})],r);var z=o(6491),Z=o(707),x=o(9141),E=o(6313),D=o(3534),S=o(6142),R=o(5718),s=o(1707),f=o(9348),L=o(1654),M=o(781),V=o(5515),O=o(298),q=o(2529),F=o(6536),Y=o(382),$=o(1303),j=o(616),I=o(6403),w=o(3297);function B(n,e){if(1&n){const a=t.EpF();t.TgZ(0,"tr"),t.TgZ(1,"td"),t.TgZ(2,"div",45),t._UZ(3,"media-image",46),t.TgZ(4,"span"),t._uU(5),t.qZA(),t.qZA(),t.qZA(),t.TgZ(6,"td",47),t._uU(7),t.qZA(),t.TgZ(8,"td",48),t._uU(9),t.qZA(),t.TgZ(10,"td",49),t._uU(11),t.qZA(),t.TgZ(12,"td",50),t.TgZ(13,"button",51),t.NdJ("click",function(){const C=t.CHM(a).$implicit;return t.oxw().detachCredit(C)}),t._UZ(14,"mat-icon",52),t.qZA(),t.qZA(),t.qZA()}if(2&n){const a=e.$implicit;t.xp6(3),t.Q6J("src",a.poster),t.xp6(2),t.Oqu(a.name),t.xp6(2),t.Oqu(null!=a.pivot&&a.pivot.character?a.pivot.character:"-"),t.xp6(2),t.hij("",null!=a.pivot&&a.pivot.department?a.pivot.department:"-"," "),t.xp6(2),t.Oqu(null!=a.pivot&&a.pivot.job?a.pivot.job:"-")}}function X(n,e){1&n&&(t.TgZ(0,"no-results-message",53),t.TgZ(1,"span",54),t._uU(2,"Nothing to display."),t.qZA(),t.qZA())}class d{constructor(e,a,i,m,C,N,at){this.store=e,this.toast=a,this.router=i,this.fb=m,this.route=C,this.uploadQueue=N,this.datatable=at,this.poster$=new z.X(null),this.personForm=this.fb.group({name:[""],poster:[""],popularity:[""],description:[""],known_for:[""],birth_place:[""],birth_date:[""],death_date:[""],gender:[null],allow_update:[!0]})}ngOnInit(){this.datatable.init(),this.route.params.subscribe(e=>{this.loadPerson(e)}),this.store.select(r.credits).subscribe(e=>{this.datatable.data=e}),this.personForm.get("poster").valueChanges.subscribe(e=>{this.poster$.next(e)})}ngOnDestroy(){this.store.dispatch(new T),this.datatable.destroy()}uploadPoster(){(0,E.r)({types:[D.j.image]}).then(e=>{this.uploadQueue.start(e,{uri:"uploads/images",httpParams:{diskPrefix:"media-images/posters"}}).subscribe(i=>{this.personForm.patchValue({poster:i.fileEntry.url})})})}loadPerson(e){!e.id||this.store.dispatch(new P(+e.id)).subscribe(()=>{const a=this.store.selectSnapshot(r.person);this.personForm.patchValue(a),this.poster$.next(a.poster)})}submit(){const e=this.store.selectSnapshot(r.person);this.store.dispatch(e.id?new y(this.personForm.value):new A(this.personForm.value)).subscribe(()=>{this.router.navigate([this.router.url.includes("admin")?"admin/people":this.router.url.split("?")[0].replace("/edit","")]),this.toast.open(e.id?Z.X.PERSON_UPDATE_SUCCESS:Z.X.PERSON_CREATE_SUCCESS)})}detachCredit(e){!e.pivot||this.store.dispatch(new b(e.pivot.id)).subscribe(()=>{this.toast.open(Z.X.CREDIT_REMOVE_SUCCESS)})}}d.\u0275fac=function(e){return new(e||d)(t.Y36(l.yh),t.Y36(R.F),t.Y36(c.F0),t.Y36(s.qu),t.Y36(c.gz),t.Y36(x.A),t.Y36(S.x))},d.\u0275cmp=t.Xpm({type:d,selectors:[["crupdate-person-page"]],features:[t._Bn([x.A,S.x])],decls:90,vars:25,consts:[["animationDuration","0ms","color","accent",1,"material-panel"],[3,"label"],["ngNativeValidate","",1,"primary-facts-panel",3,"formGroup","ngSubmit"],[1,"left-col"],["size","medium",3,"src"],["type","submit","mat-raised-button","","color","accent","trans","",1,"submit-button"],[1,"right-col","many-inputs"],[1,"inline-container","many-inputs"],[1,"input-container"],["for","name","trans",""],["type","text","formControlName","name","id","name","required",""],["for","known_for","trans",""],["type","text","formControlName","known_for","id","known_for"],["for","poster","trans",""],[1,"input-with-action","action-left"],["type","button","mat-flat-button","","color","accent",3,"matTooltip","click"],["svgIcon","file-upload"],["type","text","formControlName","poster","id","poster","minlength","1","maxlength","250"],["for","description","trans",""],["id","description","formControlName","description","cdkTextareaAutosize","","cdkAutosizeMinRows","10","cdkAutosizeMaxRows","100"],["for","gender","trans",""],["id","gender","formControlName","gender"],[3,"ngValue"],["value","male","trans",""],["value","female","trans",""],["for","birth_date","trans",""],["type","date","id","birth_date","formControlName","birth_date"],["for","death_date","trans",""],["type","date","id","death_date","formControlName","death_date"],["for","popularity","trans",""],["type","number","formControlName","popularity","id","popularity","min","1","max","1000","step","0.1"],["for","birth_place","trans",""],["type","text","id","birth_place","formControlName","birth_place"],["for","allow_update","trans",""],["formControlName","allow_update","id","allow_update","required",""],["trans","",3,"ngValue"],[1,"responsive-table"],[1,"material-table"],["table-sort-header","name","trans",""],["table-sort-header","pivot.character","trans",""],["table-sort-header","pivot.department","trans",""],["table-sort-header","pivot.job","trans",""],[4,"ngFor","ngForOf"],["svgImage","awards.svg",4,"ngIf"],[1,"overlay",3,"isVisible"],[1,"column-with-image"],["size","small",3,"src"],["data-label","Character",1,"capitalize"],["data-label","Department",1,"capitalize"],["data-label","Job",1,"capitalize"],[1,"edit-column"],["type","button","mat-icon-button","",3,"click"],["svgIcon","close"],["svgImage","awards.svg"],["primary-text","","trans",""]],template:function(e,a){1&e&&(t.TgZ(0,"mat-tab-group",0),t.TgZ(1,"mat-tab",1),t.ALo(2,"trans"),t.TgZ(3,"form",2),t.NdJ("ngSubmit",function(){return a.submit()}),t.TgZ(4,"div",3),t._UZ(5,"media-image",4),t.ALo(6,"async"),t.TgZ(7,"button",5),t._uU(8,"Save"),t.qZA(),t.qZA(),t.TgZ(9,"div",6),t.TgZ(10,"div",7),t.TgZ(11,"div",8),t.TgZ(12,"label",9),t._uU(13,"Name"),t.qZA(),t._UZ(14,"input",10),t.qZA(),t.TgZ(15,"div",8),t.TgZ(16,"label",11),t._uU(17,"Known For"),t.qZA(),t._UZ(18,"input",12),t.qZA(),t.qZA(),t.TgZ(19,"div",8),t.TgZ(20,"label",13),t._uU(21,"Image"),t.qZA(),t.TgZ(22,"div",14),t.TgZ(23,"button",15),t.NdJ("click",function(){return a.uploadPoster()}),t.ALo(24,"trans"),t._UZ(25,"mat-icon",16),t.qZA(),t._UZ(26,"input",17),t.qZA(),t.qZA(),t.TgZ(27,"div",8),t.TgZ(28,"label",18),t._uU(29,"Biography"),t.qZA(),t._UZ(30,"textarea",19),t.qZA(),t.TgZ(31,"div",7),t.TgZ(32,"div",8),t.TgZ(33,"label",20),t._uU(34,"Gender"),t.qZA(),t.TgZ(35,"select",21),t.TgZ(36,"option",22),t._uU(37,"-"),t.qZA(),t.TgZ(38,"option",23),t._uU(39,"Male"),t.qZA(),t.TgZ(40,"option",24),t._uU(41,"Female"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(42,"div",8),t.TgZ(43,"label",25),t._uU(44,"Birth Date"),t.qZA(),t._UZ(45,"input",26),t.qZA(),t.TgZ(46,"div",8),t.TgZ(47,"label",27),t._uU(48,"Death Date"),t.qZA(),t._UZ(49,"input",28),t.qZA(),t.qZA(),t.TgZ(50,"div",7),t.TgZ(51,"div",8),t.TgZ(52,"label",29),t._uU(53,"Popularity"),t.qZA(),t._UZ(54,"input",30),t.qZA(),t.TgZ(55,"div",8),t.TgZ(56,"label",31),t._uU(57,"Birth Place"),t.qZA(),t._UZ(58,"input",32),t.qZA(),t.TgZ(59,"div",8),t.TgZ(60,"label",33),t._uU(61,"Allow Auto Update"),t.qZA(),t.TgZ(62,"select",34),t.TgZ(63,"option",35),t._uU(64,"Yes"),t.qZA(),t.TgZ(65,"option",35),t._uU(66,"No"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(67,"mat-tab",1),t.ALo(68,"trans"),t.TgZ(69,"div",36),t._UZ(70,"datatable-header"),t.TgZ(71,"table",37),t.TgZ(72,"thead"),t.TgZ(73,"tr"),t.TgZ(74,"th",38),t._uU(75,"Credit"),t.qZA(),t.TgZ(76,"th",39),t._uU(77,"Character"),t.qZA(),t.TgZ(78,"th",40),t._uU(79,"Department"),t.qZA(),t.TgZ(80,"th",41),t._uU(81,"Job"),t.qZA(),t._UZ(82,"th"),t.qZA(),t.qZA(),t.TgZ(83,"tbody"),t.YNc(84,B,15,5,"tr",42),t.ALo(85,"async"),t.qZA(),t.qZA(),t.YNc(86,X,3,0,"no-results-message",43),t.ALo(87,"async"),t.qZA(),t.qZA(),t.qZA(),t._UZ(88,"loading-indicator",44),t.ALo(89,"async")),2&e&&(t.xp6(1),t.Q6J("label",t.lcZ(2,11,"Primary Facts")),t.xp6(2),t.Q6J("formGroup",a.personForm),t.xp6(2),t.Q6J("src",t.lcZ(6,13,a.poster$)),t.xp6(18),t.Q6J("matTooltip",t.lcZ(24,15,"Upload poster")),t.xp6(13),t.Q6J("ngValue",null),t.xp6(27),t.Q6J("ngValue",!0),t.xp6(2),t.Q6J("ngValue",!1),t.xp6(2),t.Q6J("label",t.lcZ(68,17,"Credits")),t.xp6(17),t.Q6J("ngForOf",t.lcZ(85,19,a.datatable.data$)),t.xp6(2),t.Q6J("ngIf",!t.lcZ(87,21,a.datatable.data$).length),t.xp6(2),t.Q6J("isVisible",t.lcZ(89,23,a.loading$)))},directives:[f.SP,f.uX,s.JL,s.sg,L.P,M.lW,V.P,s.Fj,s.JJ,s.u,s.Q7,O.gM,q.Hw,s.wO,s.nD,F.IC,s.EJ,s.YN,s.Kr,s.wV,s.qQ,s.Fd,Y.G,$.p,u.sg,u.O5,j.Q,I.U],pipes:[w.R,u.Ov],styles:["[_nghost-%COMP%]{display:block;width:100%}[_nghost-%COMP%]     .mat-tab-body-wrapper{padding:20px 0}[_nghost-%COMP%]     .mat-tab-label-content{text-transform:capitalize}[_nghost-%COMP%]     datatable-header .left-column{display:none}[_nghost-%COMP%]     datatable-header .right-column{margin:0}[_nghost-%COMP%]     datatable-header .input-container{width:400px}.inline-container[_ngcontent-%COMP%]{display:flex}.inline-container[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]{flex:1 1 auto}.inline-container[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]:not(:last-of-type){margin-right:15px}.inline-container[_ngcontent-%COMP%]   .input-container.size-small[_ngcontent-%COMP%]{flex:1 1 30%}.mat-tab-group[_ngcontent-%COMP%]{margin-bottom:25px}.primary-facts-panel[_ngcontent-%COMP%]{display:flex}.primary-facts-panel[_ngcontent-%COMP%]   .left-col[_ngcontent-%COMP%]{flex:0 0 200px;width:200px;margin-right:25px}.primary-facts-panel[_ngcontent-%COMP%]   .right-col[_ngcontent-%COMP%]{flex:1 1 auto}.primary-facts-panel[_ngcontent-%COMP%]   media-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;box-shadow:0 2px 1px -1px #0003,0 1px 1px #00000024,0 1px 3px #0000001f;border-radius:4px}.primary-facts-panel[_ngcontent-%COMP%]   .submit-button[_ngcontent-%COMP%]{width:100%;margin-top:15px;min-height:45px}no-results-message[_ngcontent-%COMP%]{margin:50px 0 40px}"],changeDetection:0}),(0,p.gn)([(0,l.Ph)(r.loading)],d.prototype,"loading$",void 0),(0,p.gn)([(0,l.Ph)(r.credits)],d.prototype,"credits$",void 0);const G=[{path:"",component:d,data:{permissions:["people.update"]}}];let K=(()=>{class n{}return n.\u0275fac=function(a){return new(a||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[c.Bz.forChild(G)],c.Bz]}),n})();var H=o(9866),W=o(6895),_=o(5217),k=o(3389),tt=o(557);let et=(()=>{class n{}return n.\u0275fac=function(a){return new(a||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[u.ez,K,H.N,s.u5,s.UX,W.M,_.u,k.p,tt.x,l.$l.forFeature([r]),f.Nh,M.ot,q.Ps,O.AV,F.Ky]]}),n})()}}]);
//# sourceMappingURL=296.b290e39f6489b6ca7fc4.js.map